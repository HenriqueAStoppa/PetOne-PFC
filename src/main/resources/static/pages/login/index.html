<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>PetOne - Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --verde-claro: #d8f3dc;
      --verde-card: #b7e4c7;
      --verde-escuro: #1b4332;
      --verde-escuro-hover: #163326;
      --texto-principal: #0f172a;
      --texto-secundario: #4b5563;
      --erro: #b91c1c;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Poppins", sans-serif;
      background-color: var(--verde-claro);
      color: var(--texto-principal);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container { width: 100%; max-width: 420px; }

    .login-card {
      background-color: white; 
      border-radius: 20px;
      padding: 40px 30px;
      box-shadow: 0 15px 35px rgba(27, 67, 50, 0.15);
      text-align: center;
      border: 1px solid var(--verde-card);
    }

    .logo-circle {
      width: 70px; height: 70px; border-radius: 50%;
      background-color: var(--verde-escuro); color: white;
      display: flex; align-items: center; justify-content: center;
      font-weight: 800; font-size: 24px; margin: 0 auto 20px;
      box-shadow: 0 4px 10px rgba(27, 67, 50, 0.3);
    }

    h1 { font-size: 26px; color: var(--verde-escuro); margin-bottom: 8px; font-weight: 700; }
    .subtitle { font-size: 14px; color: var(--texto-secundario); margin-bottom: 30px; }

    .tabs { display: flex; background: #f1f5f9; border-radius: 10px; padding: 4px; margin-bottom: 24px; }
    .tab {
        flex: 1; text-align: center; padding: 8px; font-size: 14px; font-weight: 600;
        cursor: pointer; border-radius: 8px; color: var(--texto-secundario); transition: all 0.2s;
    }
    .tab.active { background: white; color: var(--verde-escuro); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

    form { text-align: left; }
    .field { margin-bottom: 18px; }
    label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; color: #334155; }

    input[type="email"], input[type="password"] {
      width: 100%; padding: 12px 14px; border-radius: 10px; border: 1px solid #cbd5e1;
      font-size: 14px; outline: none; transition: all 0.2s; background-color: #f8fafc;
    }
    input:focus { border-color: var(--verde-escuro); background-color: white; box-shadow: 0 0 0 3px rgba(27, 67, 50, 0.1); }

    .error-message { display: none; font-size: 12px; color: var(--erro); margin-top: 5px; font-weight: 500; }
    
    #loginErrorGlobal {
        background-color: #fef2f2; border: 1px solid #fecaca; color: var(--erro);
        font-size: 13px; padding: 10px; border-radius: 8px; margin-bottom: 20px; display: none;
    }

    .btn-primary {
      width: 100%; border: none; padding: 14px; border-radius: 12px;
      background-color: var(--verde-escuro); color: white;
      font-size: 16px; font-weight: 600; cursor: pointer;
      transition: background 0.2s, transform 0.1s; margin-top: 10px;
    }
    .btn-primary:hover { background-color: var(--verde-escuro-hover); transform: translateY(-1px); }
    .btn-primary:active { transform: translateY(0); }
    .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; }

    .links { display: flex; justify-content: space-between; margin-top: 20px; font-size: 13px; }
    .links a { color: var(--verde-escuro); text-decoration: none; font-weight: 600; }
    .links a:hover { text-decoration: underline; }

    .back-link { display: block; margin-top: 30px; font-size: 13px; color: #64748b; text-decoration: none; }
    .back-link:hover { color: var(--verde-escuro); }
  </style>
</head>
<body>
  <div class="container">
    <section class="login-card">
      <div class="logo-circle">P1</div>

      <h1>Bem-vindo</h1>
      <p class="subtitle">Acesse sua conta PetOne</p>

      <div class="tabs">
          <div class="tab active" id="tab-tutor" onclick="switchTab('tutor')">Tutor</div>
          <div class="tab" id="tab-hospital" onclick="switchTab('hospital')">Hospital</div>
      </div>

      <div id="loginErrorGlobal"></div>

      <form id="loginForm" novalidate>
        <div class="field">
          <label for="usuario">Email</label>
          <input type="email" id="usuario" name="usuario" placeholder="seu@email.com" required />
          <span class="error-message" id="usuarioError">Por favor, informe seu email.</span>
        </div>

        <div class="field">
          <label for="senha">Senha</label>
          <input type="password" id="senha" name="senha" placeholder="Senha" required />
          <span class="error-message" id="senhaError">Por favor, informe sua senha.</span>
        </div>

        <button type="submit" class="btn-primary" id="btnSubmit">Entrar como Tutor</button>
      </form>

      <div class="links">
          <a href="../../cadastro_tutor.html" id="link-cadastro">Criar conta</a>
          <a href="../../recuperar_senha.html">Esqueci a senha</a>
      </div>
      
      <a href="../../index.html" class="back-link">← Voltar para a página inicial</a>
    </section>
  </div>

  <script>
    const API_URL = 'http://localhost:8080';
    let userType = 'tutor'; 

    function switchTab(type) {
        userType = type;
        
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${type}`).classList.add('active');
        
        const btn = document.getElementById('btnSubmit');
        const linkCadastro = document.getElementById('link-cadastro');
        
        if (type === 'tutor') {
            btn.textContent = 'Entrar como Tutor';
            linkCadastro.href = '../../cadastro_tutor.html';
        } else {
            btn.textContent = 'Entrar como Hospital';
            linkCadastro.href = '../../cadastro_hospital.html';
        }
        
        document.getElementById('loginErrorGlobal').style.display = 'none';
    }

    const form = document.getElementById("loginForm");
    const usuarioInput = document.getElementById("usuario");
    const senhaInput = document.getElementById("senha");
    const usuarioError = document.getElementById("usuarioError");
    const senhaError = document.getElementById("senhaError");
    const loginErrorGlobal = document.getElementById("loginErrorGlobal");
    const btnSubmit = document.getElementById("btnSubmit");

    form.addEventListener("submit", async function (event) {
      event.preventDefault();

      usuarioError.style.display = "none";
      senhaError.style.display = "none";
      loginErrorGlobal.style.display = "none";
      
      let valido = true;

      if (!usuarioInput.value.trim()) {
        usuarioError.style.display = "block";
        valido = false;
      }
      if (!senhaInput.value.trim()) {
        senhaError.style.display = "block";
        valido = false;
      }

      if (valido) {
        btnSubmit.disabled = true;
        btnSubmit.textContent = "Autenticando...";

        const loginData = {
            email: usuarioInput.value.trim(),
            senha: senhaInput.value.trim()
        };

        try {
            const endpoint = userType === 'tutor' 
                ? `${API_URL}/api/auth/login/tutor` 
                : `${API_URL}/api/auth/login/hospital`;

            const response = await fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(loginData)
            });

            if (response.ok) {
                const data = await response.json();
                
                localStorage.setItem('petone_token', data.token);
                localStorage.setItem('petone_user_nome', data.nomeCompleto);
                localStorage.setItem('petone_user_id', data.idTutor);

                if (userType === 'tutor') {
                    window.location.href = '../../dashboard_tutor.html';
                } else {
                    window.location.href = '../../dashboard_hospital.html';
                }
            } else {
                loginErrorGlobal.textContent = "Email ou senha incorretos.";
                loginErrorGlobal.style.display = "block";
            }

        } catch (error) {
            loginErrorGlobal.textContent = "Erro de conexão. Tente novamente.";
            loginErrorGlobal.style.display = "block";
        } finally {
            btnSubmit.disabled = false;
            btnSubmit.textContent = userType === 'tutor' ? 'Entrar como Tutor' : 'Entrar como Hospital';
        }
      }
    });
  </script>
</body>
</html>